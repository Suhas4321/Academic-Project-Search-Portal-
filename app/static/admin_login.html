<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DSCE Admin Portal - Secure Access</title>
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <!-- Material Symbols -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
  />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f4ff',
              100: '#e0e9ff',
              200: '#c7d8ff',
              300: '#a5bfff',
              400: '#829bff',
              500: '#6366f1',
              600: '#4f46e5',
              700: '#4338ca',
              800: '#3730a3',
              900: '#312e81',
              950: '#1e1b4b',
            },
            dark: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
              950: '#020617',
            },
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'pulse-slow': 'pulse 3s ease-in-out infinite',
            'fadeIn': 'fadeIn 0.8s ease-out',
            'slideUp': 'slideUp 0.6s ease-out',
            'shimmer': 'shimmer 2s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-12px)' },
            },
            fadeIn: {
              '0%': { opacity: '0', transform: 'scale(0.95)' },
              '100%': { opacity: '1', transform: 'scale(1)' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            shimmer: {
              '0%': { backgroundPosition: '-200% 0' },
              '100%': { backgroundPosition: '200% 0' },
            },
          },
          backdropBlur: {
            xs: '2px',
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    
    .security-pattern {
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(99, 102, 241, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 75% 75%, rgba(167, 139, 250, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 75% 25%, rgba(139, 92, 246, 0.3) 0%, transparent 25%),
        radial-gradient(circle at 25% 75%, rgba(99, 102, 241, 0.3) 0%, transparent 25%);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .shimmer-effect {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      background-size: 200% 100%;
    }

    .security-grid {
      background-image: 
        linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
      background-size: 60px 60px;
      animation: float 20s ease-in-out infinite;
    }
  </style>
</head>
<body class="w-full h-screen bg-gradient-to-br from-primary-900 via-primary-800 to-dark-900 flex items-center justify-center p-4 font-sans overflow-hidden relative">
  
  <!-- Animated Background Elements -->
  <div class="absolute inset-0 security-pattern"></div>
  <div class="absolute inset-0 security-grid opacity-30"></div>
  
  <!-- Floating Security Icons -->
  <div class="absolute top-20 left-20 text-primary-400 opacity-20 animate-float">
    <span class="material-symbols-outlined text-6xl">security</span>
  </div>
  <div class="absolute bottom-20 right-20 text-primary-300 opacity-20 animate-float" style="animation-delay: -2s;">
    <span class="material-symbols-outlined text-5xl">verified_user</span>
  </div>
  <div class="absolute top-1/3 right-32 text-primary-500 opacity-15 animate-float" style="animation-delay: -4s;">
    <span class="material-symbols-outlined text-4xl">shield</span>
  </div>
  <div class="absolute bottom-1/3 left-32 text-primary-400 opacity-15 animate-float" style="animation-delay: -3s;">
    <span class="material-symbols-outlined text-5xl">admin_panel_settings</span>
  </div>
  
  <!-- Main Login Card -->
  <div class="w-full max-w-md glass-effect rounded-2xl shadow-2xl px-8 py-8 transform hover:scale-[1.02] transition-all duration-500 animate-fadeIn relative overflow-hidden">
    
    <!-- Shimmer effect overlay -->
    <div class="absolute inset-0 shimmer-effect animate-shimmer opacity-30 pointer-events-none"></div>
    
    <!-- Header Section -->
    <div class="text-center mb-8 relative z-10">
      <div class="relative inline-block mb-6">
        <div class="absolute inset-0 bg-primary-500 rounded-full blur-lg opacity-30 animate-pulse-slow"></div>
        <div class="relative inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-primary-500 to-primary-700 rounded-full shadow-lg animate-float">
          <span class="material-symbols-outlined text-white text-5xl">admin_panel_settings</span>
        </div>
        <div class="absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center shadow-lg">
          <span class="material-symbols-outlined text-white text-sm">verified</span>
        </div>
      </div>
      
      <h1 class="text-3xl font-bold bg-gradient-to-r from-dark-800 to-primary-700 bg-clip-text text-transparent mb-2">
        DSCE Admin Portal
      </h1>
      <div class="flex items-center justify-center gap-2 mb-2">
        <span class="material-symbols-outlined text-primary-600 text-sm">security</span>
        <p class="text-sm font-medium text-dark-600">Secure Administrative Access</p>
      </div>
      <p class="text-xs text-dark-500">Authorized Personnel Only</p>
    </div>

    <!-- Security Notice -->
    <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-3 mb-6 animate-slideUp">
      <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-amber-600 text-lg">warning</span>
        <p class="text-xs text-amber-800 font-medium">
          This is a restricted area. All access attempts are logged and monitored.
        </p>
      </div>
    </div>

    <!-- Login Form -->
    <form id="loginForm" class="space-y-5 relative z-10 animate-slideUp">
      <div class="relative group">
        <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-dark-400 group-focus-within:text-primary-600 transition-colors">
          <span class="material-symbols-outlined">person</span>
        </span>
        <input
          type="text"
          id="username"
          name="username"
          required
          placeholder="Administrator Username"
          autocomplete="username"
          class="w-full pl-12 pr-4 py-3 border-2 border-dark-200 rounded-xl focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 bg-white/80 backdrop-blur-sm font-medium"
        />
        <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-primary-500 to-primary-600 opacity-0 group-focus-within:opacity-10 transition-opacity pointer-events-none"></div>
      </div>

      <div class="relative group">
        <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-dark-400 group-focus-within:text-primary-600 transition-colors">
          <span class="material-symbols-outlined">lock</span>
        </span>
        <input
          type="password"
          id="password"
          name="password"
          required
          placeholder="Secure Password"
          autocomplete="current-password"
          class="w-full pl-12 pr-12 py-3 border-2 border-dark-200 rounded-xl focus:outline-none focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 bg-white/80 backdrop-blur-sm font-medium"
        />
        <button
          type="button"
          id="togglePassword"
          class="absolute inset-y-0 right-0 flex items-center pr-4 text-dark-400 hover:text-primary-600 transition-colors"
        >
          <span class="material-symbols-outlined" id="passwordIcon">visibility_off</span>
        </button>
        <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-primary-500 to-primary-600 opacity-0 group-focus-within:opacity-10 transition-opacity pointer-events-none"></div>
      </div>

      <button
        type="submit"
        id="loginButton"
        class="w-full flex items-center justify-center py-3 px-6 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold hover:from-primary-700 hover:to-primary-800 transform hover:scale-[1.02] focus:scale-[0.98] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 shadow-lg hover:shadow-xl relative overflow-hidden group"
        disabled
      >
        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
        <span class="material-symbols-outlined text-xl mr-2 relative z-10">login</span>
        <span class="relative z-10">Secure Sign In</span>
      </button>
    </form>

    <!-- Error Message -->
    <div id="error" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-center text-red-700 text-sm font-medium hidden animate-slideUp">
      <div class="flex items-center justify-center gap-2">
        <span class="material-symbols-outlined text-lg">error</span>
        <span id="errorText"></span>
      </div>
    </div>

    <!-- Security Features -->
    <div class="mt-6 space-y-3 text-center">
      <div class="flex items-center justify-center gap-4 text-xs text-dark-500">
        <div class="flex items-center gap-1">
          <span class="material-symbols-outlined text-green-500" style="font-size: 14px;">encrypted</span>
          <span>SSL Encrypted</span>
        </div>
        <div class="flex items-center gap-1">
          <span class="material-symbols-outlined text-blue-500" style="font-size: 14px;">shield</span>
          <span>Secure Login</span>
        </div>
        <div class="flex items-center gap-1">
          <span class="material-symbols-outlined text-purple-500" style="font-size: 14px;">monitoring</span>
          <span>Monitored</span>
        </div>
      </div>
      
      <div class="border-t border-dark-200 pt-3">
        <p class="text-xs text-dark-400 font-medium">© 2025 DSCE - Administrative System</p>
        <p class="text-xs text-dark-400 mt-1">Dayanand Sagar College of Engineering</p>
      </div>
    </div>
  </div>

  <script>
    // Toggle password visibility
    const togglePassword = document.querySelector('#togglePassword');
    const passwordField = document.querySelector('#password');
    const passwordIcon = document.querySelector('#passwordIcon');

    togglePassword.addEventListener('click', () => {
      const type = passwordField.type === 'password' ? 'text' : 'password';
      passwordField.type = type;
      passwordIcon.textContent = type === 'password' ? 'visibility_off' : 'visibility';
    });

    // Inputs & button
    const usernameField = document.querySelector('#username');
    const loginButton   = document.querySelector('#loginButton');
    const errorDiv      = document.querySelector('#error');
    const errorText     = document.querySelector('#errorText');
    const loginForm     = document.querySelector('#loginForm');

    function validateInputs() {
      loginButton.disabled = !(usernameField.value.trim() && passwordField.value.trim());
    }
    usernameField.addEventListener('input', validateInputs);
    passwordField.addEventListener('input', validateInputs);
    validateInputs();

    // ✅ UPDATED: Handle form submission with proper redirect handling
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorDiv.classList.add('hidden');

      // Add loading state
      const originalButtonContent = loginButton.innerHTML;
      loginButton.innerHTML = `
        <div class="flex items-center justify-center">
          <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
          <span>Authenticating...</span>
        </div>
      `;
      loginButton.disabled = true;

      try {
        const response = await fetch('/api/admin/login', {
          method: 'POST',
          body: new FormData(loginForm),
          credentials: 'include'  // ✅ Include cookies/session
        });

        if (response.ok) {
          const data = await response.json();  // ✅ Parse JSON response
          
          loginButton.innerHTML = `
            <span class="material-symbols-outlined text-xl mr-2">check_circle</span>
            <span>Access Granted</span>
          `;
          
          setTimeout(() => {
            // ✅ Use redirect URL from backend response
            if (data.redirect) {
              window.location.href = data.redirect;
            } else {
              // ✅ Fallback redirect
              window.location.href = '/static/admin_panel.html';
            }
          }, 1000);
          
        } else if (response.status === 401) {
          errorText.textContent = 'Invalid credentials. Access denied.';
          errorDiv.classList.remove('hidden');
          loginButton.innerHTML = originalButtonContent;
          validateInputs();
        } else {
          errorText.textContent = 'Authentication service unavailable.';
          errorDiv.classList.remove('hidden');
          loginButton.innerHTML = originalButtonContent;
          validateInputs();
        }
      } catch (err) {
        console.error('Login error:', err);  // ✅ Added error logging
        errorText.textContent = 'Network error. Please check your connection.';
        errorDiv.classList.remove('hidden');
        loginButton.innerHTML = originalButtonContent;
        validateInputs();
      }
    });

    // Add focus effects and animations
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        input.parentElement.classList.add('scale-[1.02]');
      });
      
      input.addEventListener('blur', () => {
        input.parentElement.classList.remove('scale-[1.02]');
      });
    });

    // Security notice auto-hide
    setTimeout(() => {
      const securityNotice = document.querySelector('.bg-gradient-to-r.from-amber-50');
      if (securityNotice) {
        securityNotice.style.transition = 'all 0.5s ease-out';
        securityNotice.style.transform = 'translateY(-10px)';
        securityNotice.style.opacity = '0.7';
      }
    }, 5000);
  </script>
</body>
</html>
